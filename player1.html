<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">

  <title>Scorekeeper Player 1</title>
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.4.min.js"
  integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
  crossorigin="anonymous"></script>
  <script src="https://apis.google.com/js/platform.js" async defer></script>
</head>
<body>

  <!--Begin oAuth2.0 Code -->
  <script>
  var GoogleAuth;
  var SCOPE = 'https://www.googleapis.com/auth/spreadsheets';
  function handleClientLoad() {
    // Load the API's client and auth2 modules.
    // Call the initClient function after the modules load.
    gapi.load('client:auth2', initClient);
  }

  function initClient() {
    // Retrieve the discovery document for version 4 of Google Sheets API.
    // In practice, your app can retrieve one or more discovery documents.
    var discoveryUrl = 'https://sheets.googleapis.com/$discovery/rest?version=v4';

    // Initialize the gapi.client object, which app uses to make API requests.
    // Get API key and client ID from API Console.
    // 'scope' field specifies space-delimited list of access scopes.
    gapi.client.init({
      'apiKey': 'AIzaSyAsmkXes_MzqYAjAO_J9gooiwolUoZl5M0',
      'discoveryDocs': [discoveryUrl],
      'clientId': '651150583918-pcnvjcgd6803ph6hrm08ft7tg47na46t.apps.googleusercontent.com',
      'scope': SCOPE
    }).then(function () {
      GoogleAuth = gapi.auth2.getAuthInstance();

      // Listen for sign-in state changes.
      GoogleAuth.isSignedIn.listen(updateSigninStatus);

      // Handle initial sign-in state. (Determine if user is already signed in.)
      var user = GoogleAuth.currentUser.get();
      setSigninStatus();

      // Call handleAuthClick function when user clicks on
      //      "Sign In/Authorize" button.
      $('#sign-in-or-out-button').click(function() {
        handleAuthClick();
      }); 
      $('#revoke-access-button').click(function() {
        revokeAccess();
      }); 
    });
  }

  function handleAuthClick() {
    if (GoogleAuth.isSignedIn.get()) {
      // User is authorized and has clicked 'Sign out' button.
      GoogleAuth.signOut();
    } else {
      // User is not signed in. Start Google auth flow.
      GoogleAuth.signIn();
    }
  }

  function revokeAccess() {
    GoogleAuth.disconnect();
  }

  function setSigninStatus(isSignedIn) {
    var user = GoogleAuth.currentUser.get();
    var isAuthorized = user.hasGrantedScopes(SCOPE);
    if (isAuthorized) {
      $('#sign-in-or-out-button').html('Sign out');
      $('#revoke-access-button').css('display', 'inline-block');
      $('#auth-status').html('You are currently signed in and have granted ' +
        'access to this app.');
    } else {
      $('#sign-in-or-out-button').html('Sign In/Authorize');
      $('#revoke-access-button').css('display', 'none');
      $('#auth-status').html('You have not authorized this app or you are ' +
        'signed out.');
    }
  }

  function updateSigninStatus(isSignedIn) {
    setSigninStatus();
  }
  </script>

  <button id="sign-in-or-out-button"
  style="margin-left: 25px">Sign In/Authorize</button>
  <button id="revoke-access-button"
  style="display: none; margin-left: 25px">Revoke access</button>

  <div id="auth-status" style="display: inline; padding-left: 25px"></div><hr>

  <script async defer src="https://apis.google.com/js/api.js" 
  onload="this.onload=function(){};handleClientLoad()" 
  onreadystatechange="if (this.readyState === 'complete') this.onload()">
  </script>

  <!-- End oAuth2.0 Code -->

  <p id="p1Score"></p>
  <button id="p1Plus" type="button">Player1 +</button>

  <script>
  $("#p1Plus").click(function() {
    	//send a post request to the api
    	var p1Score = $.get("https://sheets.googleapis.com/v4/spreadsheets/1Ipd_1vkwHtCQdj1zcNyzTRFil1CclmyufVqr4vIP8MI/values/main!B1:B1?key=AIzaSyAsmkXes_MzqYAjAO_J9gooiwolUoZl5M0", function (data) {
    		//parse data to get what you want
    		var value = parseInt(data.values[0][0]);
        //log the value
        console.log('value: ' + value);
    		//add 1 to the score
    		value = value + 1;

    		var valueAsPayload = {
    			"range": "main!B1:B1",
    			"majorDimension": "ROWS",
    			"values": [
          [value]
          ],
        }

        //Use gapi.client.request(args) function
        var request = gapi.client.request({
          'method': 'PUT',
          'path': 'https://sheets.googleapis.com/v4/spreadsheets/1Ipd_1vkwHtCQdj1zcNyzTRFil1CclmyufVqr4vIP8MI/values/main!B1:B1',
          'params': {
            'key': 'AIzaSyAsmkXes_MzqYAjAO_J9gooiwolUoZl5M0',
            'valueInputOption': 'USER_ENTERED'
          },
          'body': valueAsPayload
        });

        //Execute the API request.
        request.execute(function(response) {
          //console.log(response);
        });
    	});
});
</script>

<p id="p2score"></p>
<button id="p2Plus" type="button">Player2 +</button>
</body>
</html>